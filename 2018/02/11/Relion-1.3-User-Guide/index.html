
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>Relion-1.3 软件使用流程 | Fendrew</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Feng Wang">
    

    
    <meta name="description" content="这里将会详细的介绍Relion软件使用的流程，每个任务具体的参数设定参考官网relion13_tutorial，这里主要介绍蛋白质3D重构的过程。Relion提供了简单的GUI来方便使用,GUI是使用的fltk-1.3.0来设计的。其GUI界面如下：下面将采用从官网下载的数据relion13_tutorial.tar.gz来做3D 结构重构。 ##第一步：数据预处理 ###1.1 初始数据给的初始">
<meta property="og:type" content="article">
<meta property="og:title" content="Relion-1.3 软件使用流程">
<meta property="og:url" content="http://nejyeah.github.io/2018/02/11/Relion-1.3-User-Guide/index.html">
<meta property="og:site_name" content="Fendrew">
<meta property="og:description" content="这里将会详细的介绍Relion软件使用的流程，每个任务具体的参数设定参考官网relion13_tutorial，这里主要介绍蛋白质3D重构的过程。Relion提供了简单的GUI来方便使用,GUI是使用的fltk-1.3.0来设计的。其GUI界面如下：下面将采用从官网下载的数据relion13_tutorial.tar.gz来做3D 结构重构。 ##第一步：数据预处理 ###1.1 初始数据给的初始">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://7u2kdd.com1.z0.glb.clouddn.com/GUI_Relion.png">
<meta property="og:image" content="http://7u2kdd.com1.z0.glb.clouddn.com/S-original-33-35-0-mrc.png">
<meta property="og:image" content="http://7u2kdd.com1.z0.glb.clouddn.com/S-original-33-35-0-mrcs.png">
<meta property="og:image" content="http://7u2kdd.com1.z0.glb.clouddn.com/S-2D-classification-sample-average-10.png">
<meta property="og:image" content="http://7u2kdd.com1.z0.glb.clouddn.com/S-autopick-33-35-t0.8-d200.png">
<meta property="og:image" content="http://7u2kdd.com1.z0.glb.clouddn.com/S-autopick-57-34-t0.8-d200.png">
<meta property="og:image" content="http://7u2kdd.com1.z0.glb.clouddn.com/S-autopick-33-35-t0.92-d200.png">
<meta property="og:image" content="http://7u2kdd.com1.z0.glb.clouddn.com/S-autopick-57-34-t0.92-d200.png">
<meta property="og:image" content="http://7u2kdd.com1.z0.glb.clouddn.com/S-autopick-33-35-t0.4-d110.png">
<meta property="og:image" content="http://7u2kdd.com1.z0.glb.clouddn.com/S-autopick-57-34-t0.4-d110.png">
<meta property="og:image" content="http://7u2kdd.com1.z0.glb.clouddn.com/S-particles-autopick-sort.png">
<meta property="og:image" content="http://7u2kdd.com1.z0.glb.clouddn.com/S-2D-class100-average.png">
<meta property="og:image" content="http://7u2kdd.com1.z0.glb.clouddn.com/S-particles-autopick-sort-class2d.png">
<meta property="og:image" content="http://7u2kdd.com1.z0.glb.clouddn.com/S-Initial-model-3I3E-crystal-struction.png">
<meta property="og:image" content="http://7u2kdd.com1.z0.glb.clouddn.com/S-Initial-model-3I3E-50A.png">
<meta property="og:image" content="http://7u2kdd.com1.z0.glb.clouddn.com/S-class3d-it025-class001-mrc.png">
<meta property="og:image" content="http://7u2kdd.com1.z0.glb.clouddn.com/S-class3d-it025-class002-mrc.png">
<meta property="og:image" content="http://7u2kdd.com1.z0.glb.clouddn.com/S-class3d-it025-class003-mrc.png">
<meta property="og:image" content="http://7u2kdd.com1.z0.glb.clouddn.com/S-class3d-it025-class004-mrc.png">
<meta property="og:image" content="http://7u2kdd.com1.z0.glb.clouddn.com/S-class3d-it025-class001-model.png">
<meta property="og:image" content="http://7u2kdd.com1.z0.glb.clouddn.com/S-class3d-it025-class002-model.png">
<meta property="og:image" content="http://7u2kdd.com1.z0.glb.clouddn.com/S-class3d-it025-class003-model.png">
<meta property="og:image" content="http://7u2kdd.com1.z0.glb.clouddn.com/S-class3d-it025-class004-model.png">
<meta property="og:image" content="http://7u2kdd.com1.z0.glb.clouddn.com/S-class3d-4class-choose13.png">
<meta property="og:image" content="http://7u2kdd.com1.z0.glb.clouddn.com/S-class3d-it025-class1&2&3&4.png">
<meta property="og:image" content="http://7u2kdd.com1.z0.glb.clouddn.com/S-class3d-it025-class1&3.png">
<meta property="og:image" content="http://7u2kdd.com1.z0.glb.clouddn.com/S-refine3d-it21-half1-model.png">
<meta property="og:image" content="http://7u2kdd.com1.z0.glb.clouddn.com/S-refine3d-it21-half2-model.png">
<meta property="og:image" content="http://7u2kdd.com1.z0.glb.clouddn.com/S-refine3d-it21-half1&2.png">
<meta property="og:image" content="http://7u2kdd.com1.z0.glb.clouddn.com/S-refine3d-class001-model.png">
<meta property="og:image" content="http://7u2kdd.com1.z0.glb.clouddn.com/S-refine3d-class001-mrc.png">
<meta property="og:updated_time" content="2018-02-11T06:02:15.871Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Relion-1.3 软件使用流程">
<meta name="twitter:description" content="这里将会详细的介绍Relion软件使用的流程，每个任务具体的参数设定参考官网relion13_tutorial，这里主要介绍蛋白质3D重构的过程。Relion提供了简单的GUI来方便使用,GUI是使用的fltk-1.3.0来设计的。其GUI界面如下：下面将采用从官网下载的数据relion13_tutorial.tar.gz来做3D 结构重构。 ##第一步：数据预处理 ###1.1 初始数据给的初始">
<meta name="twitter:image" content="http://7u2kdd.com1.z0.glb.clouddn.com/GUI_Relion.png">

    
    <link rel="alternative" href="/atom.xml" title="Fendrew" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="Fendrew" title="Fendrew"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Fendrew">Fendrew</a></h1>
				<h2 class="blog-motto">enjoy learning</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="/search/index.html" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" autocomplete="off" name="q" maxlength="20" placeholder="搜索" />
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2018/02/11/Relion-1.3-User-Guide/" title="Relion-1.3 软件使用流程" itemprop="url">Relion-1.3 软件使用流程</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Feng Wang" target="_blank" itemprop="author">Feng Wang</a>
		
  <p class="article-time">
    <time datetime="2018-02-11T06:02:15.871Z" itemprop="datePublished"> 发表于 2018-02-11</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		
			<ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-2-转换为STAR文件"><span class="toc-number">1.</span> <span class="toc-text">1.2.2 转换为STAR文件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-CTF-参数估计"><span class="toc-number"></span> <span class="toc-text">1.3 CTF 参数估计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-颗粒挑选"><span class="toc-number"></span> <span class="toc-text">1.4 颗粒挑选</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-1-人工挑选"><span class="toc-number">1.</span> <span class="toc-text">1.3.1 人工挑选</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-2-半自动挑选-autopick"><span class="toc-number">2.</span> <span class="toc-text">1.3.2 半自动挑选[^autopick]</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5-颗粒排序-可选过程"><span class="toc-number"></span> <span class="toc-text">1.5 颗粒排序(可选过程)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第二步：-Reference-free-2D-class-averaging"><span class="toc-number"></span> <span class="toc-text">第二步： Reference-free 2D class averaging</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-2D-class-averaging-的作用"><span class="toc-number"></span> <span class="toc-text">2.1 2D class averaging 的作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-运行时“exceeds-stack-size”错误及解决办法"><span class="toc-number"></span> <span class="toc-text">2.2 运行时“exceeds stack size”错误及解决办法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-运行2D-classification"><span class="toc-number"></span> <span class="toc-text">2.3 运行2D classification</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第三步：-Unsupervised-3D-classification"><span class="toc-number"></span> <span class="toc-text">第三步： Unsupervised 3D classification</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-目的"><span class="toc-number"></span> <span class="toc-text">3.1 目的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-运行结果"><span class="toc-number"></span> <span class="toc-text">3.2 运行结果</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第四步：High-resolution-3D-refinement"><span class="toc-number"></span> <span class="toc-text">第四步：High-resolution 3D refinement</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-目的"><span class="toc-number"></span> <span class="toc-text">4.1 目的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-运行结果"><span class="toc-number"></span> <span class="toc-text">4.2 运行结果</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第五步：-Postprocessing"><span class="toc-number"></span> <span class="toc-text">第五步： Postprocessing</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第六步：-Local-resolution-estimation"><span class="toc-number"></span> <span class="toc-text">第六步： Local-resolution estimation</span></a>
		
		</div>
		
		<p>这里将会详细的介绍Relion软件使用的流程，每个任务具体的参数设定参考官网<a href="http://www2.mrc-lmb.cam.ac.uk/groups/scheres/relion13_tutorial.pdf" target="_blank" rel="noopener">relion13_tutorial</a>，这里主要介绍蛋白质3D重构的过程。<br>Relion提供了简单的GUI来方便使用,GUI是使用的<strong>fltk-1.3.0</strong>来设计的。其GUI界面如下：<br><img src="http://7u2kdd.com1.z0.glb.clouddn.com/GUI_Relion.png" alt="Relion GUI"><br>下面将采用从官网下载的数据<strong>relion13_tutorial.tar.gz</strong>来做3D 结构重构。</p>
<p>##第一步：数据预处理</p>
<p>###1.1 初始数据<br>给的初始数据是15张电镜下拍到的原始大图片，格式是<code>.mrc</code>的，其次还包含15个<code>.mrcs</code>的movie图片。Relion中单张图片是以<code>.mrc</code>存储的，多张图片是以<code>.mrcs</code>存储。<br>原始的<code>.mrc</code>中单张<a href="http://7u2kdd.com1.z0.glb.clouddn.com/S-original-33-35-0-mrc.png" target="_blank" rel="noopener">图片33_35</a>显示如下：<br><img src="http://7u2kdd.com1.z0.glb.clouddn.com/S-original-33-35-0-mrc.png" alt="14-33-35-0-mrc"><br>原始的<code>.mrcs</code>中movie的<a href="http://7u2kdd.com1.z0.glb.clouddn.com/S-original-33-35-0-mrcs.png" target="_blank" rel="noopener">图片33_35</a>如下,可以暂时不管这个movie的图片：<br><img src="http://7u2kdd.com1.z0.glb.clouddn.com/S-original-33-35-0-mrcs.png" alt="此处输入图片的描述"></p>
<p>###1.2 准备数据</p>
<p>####1.2.1 STAR 文件格式简介<br>Relion的输入数据采用STAR格式，一个简单的STAR文件如下：</p>
<pre><code>data_images
loop_
_rlnImageName
_rlnDefocusU
_rlnDefocusV
_rlnDefocusAngle
_rlnVoltage
_rlnAmplitudeContrast
_rlnSphericalAberration
000001@/lmb/home/scheres/data/VP7/all_images.mrcs 13538 13985 109.45 300 0.15 2
000002@/lmb/home/scheres/data/VP7/all_images.mrcs 13293 13796 109.45 300 0.15 2
000003@/lmb/home/scheres/data/VP7/all_images.mcrs 13626 14085 109.45 300 0.15 2
</code></pre><p><code>data_</code>代表了一个data block的开始，STAR文件可以包含多个 data block。<br><code>loop_</code>后面接多个labels,相当于列的名称。<br><code>_rlnImageName</code>,<code>_rlnDefocusU</code>等等这几个以<code>_</code>开头的代表了 Label name. Relion有一套自己定义的一些Label name,可以通过命令<code>relion_refine --print_metadata_labels</code>来察看其定义的一些Label name的含义。<br>最后面的3行数据就代表了各个labels的值。</p>
<h4 id="1-2-2-转换为STAR文件"><a href="#1-2-2-转换为STAR文件" class="headerlink" title="1.2.2 转换为STAR文件"></a>1.2.2 转换为STAR文件</h4><p>使用Relion 中<code>Micrograph inspection</code>功能，设置好各种参数后就可以run执行，其对应的command如下：</p>
<blockquote>
<p>> `which relion_manualpick` –i “Micrographs/*.mrc” –o all_micrographs.star –pickname manual –scale 0.2 –sigma_contrast 3 –black 0 –white 0 –lowpass 20 –angpix 3.5 –ctf_scale 1 –particle_diameter 200 &amp;</p>
</blockquote>
<p>输出文件：all_micrographs.star</p>
<h3 id="1-3-CTF-参数估计"><a href="#1-3-CTF-参数估计" class="headerlink" title="1.3 CTF 参数估计"></a>1.3 CTF 参数估计</h3><p>Relion是直接调用软件CTFFIND3来并行的计算每一个micrographs的 Contrast Transfer Function的参数。其对应的command命令如下：</p>
<blockquote>
<p>$ `which relion_run_ctffind` –i “all_micrographs.star” –o “all_micrographs_ctf.star” –ctfWin -1 –CS 2 –HT 300 –AmpCnst 0.1 –XMAG 40000 –DStep 14 –Box 512 –ResMin 100 –ResMax 7 –dFMin 5000 –dFMax 50000 –FStep 500 –dAst 0 –ctffind3_exe “/home/nej/wf/ctffind/ctffind –omp-num-threads 1 –old-school-input”</p>
</blockquote>
<p>输入： all_micrographs.star<br>输出： all_micrographs_ctf.star<br>耗时： 单进程 27min</p>
<h3 id="1-4-颗粒挑选"><a href="#1-4-颗粒挑选" class="headerlink" title="1.4 颗粒挑选"></a>1.4 颗粒挑选</h3><h4 id="1-3-1-人工挑选"><a href="#1-3-1-人工挑选" class="headerlink" title="1.3.1 人工挑选"></a>1.3.1 人工挑选</h4><p>Relion提供了人工挑选的功能，其次还支持其他软件挑选结果的格式支持，例如：</p>
<blockquote>
<ul>
<li>coordinate file formate for Jude Short`s Ximdisp<a href="with any extension">^ximdisp</a></li>
<li>XMIPP-2.4<a href="with any extension">^xmipp</a></li>
<li>Steven Luditke`s e2boxer.py<a href="with a . box extension">^e2boxer</a></li>
</ul>
</blockquote>
<h4 id="1-3-2-半自动挑选-autopick"><a href="#1-3-2-半自动挑选-autopick" class="headerlink" title="1.3.2 半自动挑选[^autopick]"></a>1.3.2 半自动挑选[^autopick]</h4><p>半自动挑选的简单流程如下：</p>
<ol>
<li>人工挑选一定数量的粒子</li>
<li>对人工挑选出来的粒子做 <strong>2D classification</strong>,即聚类，取每个类 averaged image 作为 Auto-picking的 templates</li>
<li>按一定的相似性比较来自动挑选</li>
</ol>
<p><strong>step1:</strong><br>人工挑选，上一步已做。<br><strong>step2:</strong><br>采用上一步manual pick的粒子，进行 <strong>2D classification</strong>.</p>
<blockquote>
<ul>
<li>Input：particles_manual.star</li>
<li>Number of Classes: 10</li>
<li>Number of particles: about 1000</li>
<li>time cost: 18 min (i7-4930k,3.4GZ,1 cpu,6 cpu cores,12 processors)，MPI 采用11个进程，每个进程采用1个线程。</li>
</ul>
</blockquote>
<p>产生的10个类<a href="http://7u2kdd.com1.z0.glb.clouddn.com/S-2D-classification-sample-average-10.png" target="_blank" rel="noopener">average图</a>如下：<br><img src="http://7u2kdd.com1.z0.glb.clouddn.com/S-2D-classification-sample-average-10.png" alt="此处输入图片的描述"><br>从中挑选较好的类作为模版。</p>
<p><strong>step3:</strong><br>在进行全局的启动挑选之前，需要优化两个auto-picking所需的参数：<br><strong>Picking threshold:</strong><br><strong>Minimum inter-particle distance:</strong><br>选取少量有代表性的Micrographs来对这两个参数进行评估优化。选择<a href="http://7u2kdd.com1.z0.glb.clouddn.com/S-original-33-35-0-mrc.png" target="_blank" rel="noopener">*_33_35_0.mrc</a>和<a href="http://7u2kdd.com1.z0.glb.clouddn.com/S-original-57-34-0-mrc.png" target="_blank" rel="noopener">*_57_34_0.mrc</a>。<br>初始值 <code>Picking threshold = 0.8</code>,<code>Minimum inter-particle distance = 200</code>. 并且 <code>Write FOM map ? Yes</code></p>
<blockquote>
<ul>
<li>input: <em>_33_35_0.mrc and </em>_57_34_0.mrc</li>
<li>time cost : 4 min</li>
</ul>
</blockquote>
<p>因为有IO 读写，所以这里只能单线程的跑，以防指IO 冲突错误。<br>结果如下:</p>
<blockquote>
<p>Picking threshold = 0.8 , Minimum inter-particle distance = 200</p>
</blockquote>
<p>number(<a href="http://7u2kdd.com1.z0.glb.clouddn.com/S-autopick-33-35-t0.8-d200.png" target="_blank" rel="noopener">*_33_35</a>) = 175<br>number(<a href="http://7u2kdd.com1.z0.glb.clouddn.com/S-autopick-57-34-t0.8-d200.png" target="_blank" rel="noopener">*_57_34</a>) = 212<br><img src="http://7u2kdd.com1.z0.glb.clouddn.com/S-autopick-33-35-t0.8-d200.png" alt="此处输入图片的描述"><br><img src="http://7u2kdd.com1.z0.glb.clouddn.com/S-autopick-57-34-t0.8-d200.png" alt="此处输入图片的描述"><br>调节 Picking threshold = 0.92 , Minimum inter-particle distance = 200，<br>number(<a href="http://7u2kdd.com1.z0.glb.clouddn.com/S-autopick-33-35-t0.92-d200.png" target="_blank" rel="noopener">*_33_35</a>) = 170<br>number(<a href="http://7u2kdd.com1.z0.glb.clouddn.com/S-autopick-57-34-t0.92-d200.png" target="_blank" rel="noopener">*_57_34</a>) = 175<br><img src="http://7u2kdd.com1.z0.glb.clouddn.com/S-autopick-33-35-t0.92-d200.png" alt="此处输入图片的描述"><br><img src="http://7u2kdd.com1.z0.glb.clouddn.com/S-autopick-57-34-t0.92-d200.png" alt="此处输入图片的描述"><br>调节 Picking threshold = 0.4 , Minimum inter-particle distance = 110,<br>number(<a href="http://7u2kdd.com1.z0.glb.clouddn.com/S-autopick-33-35-t0.4-d110.png" target="_blank" rel="noopener">*_33_35</a>) = 610<br>number(<a href="http://7u2kdd.com1.z0.glb.clouddn.com/S-autopick-57-34-t0.4-d110.png" target="_blank" rel="noopener">*_57_34</a>) = 685<br><img src="http://7u2kdd.com1.z0.glb.clouddn.com/S-autopick-33-35-t0.4-d110.png" alt="此处输入图片的描述"><br><img src="http://7u2kdd.com1.z0.glb.clouddn.com/S-autopick-57-34-t0.4-d110.png" alt="此处输入图片的描述"><br>调节好参数后就可以对所有的Micrographs来进行挑选，这个时候就不需要将FOM maps写下来了。只需跑一次就完了。</p>
<p>对所有的图片进行<strong>Auto-picking</strong>.设置参数：Picking threshold = 0.4 , Minimum inter-particle distance = 110。这里可以多进程跑，但是最大的MPI进程数就是Micrographs的数量。也就是说这里并行的策略是基于文件级别的。</p>
<blockquote>
<ul>
<li>input:     all_micrographs_ctf.star</li>
<li>time cost: 6.2 min (15 process)</li>
</ul>
</blockquote>
<p>然后再根据生成的粒子坐标文件将粒子提取出来。</p>
<h3 id="1-5-颗粒排序-可选过程"><a href="#1-5-颗粒排序-可选过程" class="headerlink" title="1.5 颗粒排序(可选过程)"></a>1.5 颗粒排序(可选过程)</h3><p>对已经挑出来的粒子<code>particles_autopick.star</code>进行排序，排序的reference是<code>manual_7classes.star</code>，应该是对粒子与那写模版做一个距离比较，然后按照此距离来排序。通过这个步骤可以进一步的对颗粒进行挑选，剔除距离远的粒子。最后挑选出来的粒子存储在：Particles_autopick_sort.star,其<a href="http://7u2kdd.com1.z0.glb.clouddn.com/S-particles-autopick-sort.png" target="_blank" rel="noopener">图片</a>显示如下：<br><img src="http://7u2kdd.com1.z0.glb.clouddn.com/S-particles-autopick-sort.png" alt="此处输入图片的描述"></p>
<h2 id="第二步：-Reference-free-2D-class-averaging"><a href="#第二步：-Reference-free-2D-class-averaging" class="headerlink" title="第二步： Reference-free 2D class averaging"></a>第二步： Reference-free 2D class averaging</h2><h3 id="2-1-2D-class-averaging-的作用"><a href="#2-1-2D-class-averaging-的作用" class="headerlink" title="2.1 2D class averaging 的作用"></a>2.1 2D class averaging 的作用</h3><p>虽然前面数据预处理部分花了很大的精力来挑选好的颗粒，剔除 bad particles，使用 manually supervising the auto-picking results and sorting the particles.但是还是有一些bad particles.采用2D classification 来进一步剔除这些粒子图片，因为这种bad particles在进行聚类时会被聚到相对粒子数较少的类，且average出来的结果并不很好。</p>
<h3 id="2-2-运行时“exceeds-stack-size”错误及解决办法"><a href="#2-2-运行时“exceeds-stack-size”错误及解决办法" class="headerlink" title="2.2 运行时“exceeds stack size”错误及解决办法"></a>2.2 运行时“exceeds stack size”错误及解决办法</h3><p>使用<code>2D classification</code>功能,设置成process =11 , thread =1 memory=1GB/thread和 process = 5 , thread =1 memory=2GB/thread都报错如下：</p>
<pre><code> Estimating initial noise spectra 
000/??? sec ~~(,_,&quot;&gt;                                                          [o   2/  60 sec ..~~(,_,&quot;&gt;readMRC: Image number 600 exceeds stack size 557
File: ./src/rwMRC.h line: 189
--------------------------------------------------------------------------
MPI_ABORT was invoked on rank 2 in communicator MPI_COMM_WORLD 
with errorcode 1.
</code></pre><p>从上面错误内容来看，貌似是应为内存不够导致读取图片的时候内存溢出。不管在呢么设置，即使设置成单进程线程也报错。仔细查了下数据，发现教程给的sort之后的数据和我自动扣取下来不匹配，例如在<code>particles_autopick_sort.star</code>中现实有超过600个颗粒是从44_07和55_40中提取的，结果我察看自己自动提取的这两个star文件，发现，44_07只有578个颗粒，55_40只有593个颗粒，所以这个都去数据是就会有溢出的错误。<br>解决办法是采用它提供的自动pick出来的star坐标文件，再重新提取一下颗粒，自己auto-pick可能中间哪设置错了导致提取的和它不同。</p>
<h3 id="2-3-运行2D-classification"><a href="#2-3-运行2D-classification" class="headerlink" title="2.3 运行2D classification"></a>2.3 运行2D classification</h3><blockquote>
<ul>
<li>input: particles_autopick_sort.star (颗粒图片数量9120)</li>
<li>class number: 100</li>
<li>time cost: 11h30min (MPI processor= 12,threads=1,memory = 1GB/thread)</li>
</ul>
</blockquote>
<p>聚类后生成了100个类,从这些类中挑选出所有 nice-looking classes, 将这些good classes 包含的所有粒子都存储到<code>particles_autopick_sort_class2d.star</code>中。这个过程可以多次跑来剔除bad particles.<br>100个类的<a href="http://7u2kdd.com1.z0.glb.clouddn.com/S-2D-class100-average.png" target="_blank" rel="noopener">average图</a>如下：<br><img src="http://7u2kdd.com1.z0.glb.clouddn.com/S-2D-class100-average.png" alt="此处输入图片的描述"><br>剔除不好的类之后(9120 -&gt; 8914 particles)得到的<a href="http://7u2kdd.com1.z0.glb.clouddn.com/S-particles-autopick-sort-class2d.png" target="_blank" rel="noopener">particles图片</a>如下：<br><img src="http://7u2kdd.com1.z0.glb.clouddn.com/S-particles-autopick-sort-class2d.png" alt="此处输入图片的描述"></p>
<h2 id="第三步：-Unsupervised-3D-classification"><a href="#第三步：-Unsupervised-3D-classification" class="headerlink" title="第三步： Unsupervised 3D classification"></a>第三步： Unsupervised 3D classification</h2><h3 id="3-1-目的"><a href="#3-1-目的" class="headerlink" title="3.1 目的"></a>3.1 目的</h3><h3 id="3-2-运行结果"><a href="#3-2-运行结果" class="headerlink" title="3.2 运行结果"></a>3.2 运行结果</h3><p>首先是需要一个初始的3D 模型toturial中给了一个beta-galactosidase的低分辨率模型<a href="http://7u2kdd.com1.z0.glb.clouddn.com/S-Initial-model-3I3E-50A.png" target="_blank" rel="noopener">3i3e_lp50.mrc</a>，该模型是由其高分辨率的<a href="http://7u2kdd.com1.z0.glb.clouddn.com/S-Initial-model-3I3E-crystal-struction.png" target="_blank" rel="noopener">crystal structure</a>产生的。<br><img src="http://7u2kdd.com1.z0.glb.clouddn.com/S-Initial-model-3I3E-crystal-struction.png" alt="此处输入图片的描述"><br><img src="http://7u2kdd.com1.z0.glb.clouddn.com/S-Initial-model-3I3E-50A.png" alt="此处输入图片的描述"></p>
<blockquote>
<p>input: particles_autopick_sort_class2d.star(8914 particles)<br>Number of Classes : 4<br>Reference map: <a href="http://7u2kdd.com1.z0.glb.clouddn.com/S-Initial-model-3I3E-50A.png" target="_blank" rel="noopener">3i3e_lp50.mrc</a><br>Number of iteration: 25</p>
</blockquote>
<p>迭代25次后生成了4个3d model类,可以看其2D slices图或3D model图。<br>其四个类对应的slices图如下:<br><a href="http://7u2kdd.com1.z0.glb.clouddn.com/S-class3d-it025-class001-mrc.png" target="_blank" rel="noopener">class001</a><br><a href="http://7u2kdd.com1.z0.glb.clouddn.com/S-class3d-it025-class002-mrc.png" target="_blank" rel="noopener">class002</a><br><a href="http://7u2kdd.com1.z0.glb.clouddn.com/S-class3d-it025-class003-mrc.png" target="_blank" rel="noopener">class003</a><br><a href="http://7u2kdd.com1.z0.glb.clouddn.com/S-class3d-it025-class004-mrc.png" target="_blank" rel="noopener">class004</a><br><img src="http://7u2kdd.com1.z0.glb.clouddn.com/S-class3d-it025-class001-mrc.png" alt="此处输入图片的描述"><br><img src="http://7u2kdd.com1.z0.glb.clouddn.com/S-class3d-it025-class002-mrc.png" alt="此处输入图片的描述"><br><img src="http://7u2kdd.com1.z0.glb.clouddn.com/S-class3d-it025-class003-mrc.png" alt="此处输入图片的描述"><br><img src="http://7u2kdd.com1.z0.glb.clouddn.com/S-class3d-it025-class004-mrc.png" alt="此处输入图片的描述"></p>
<p>其四个类对应的3D modle图如下：<br><a href="http://7u2kdd.com1.z0.glb.clouddn.com/S-class3d-it025-class001-model.png" target="_blank" rel="noopener">3D model class001</a><br><a href="http://7u2kdd.com1.z0.glb.clouddn.com/S-class3d-it025-class002-model.png" target="_blank" rel="noopener">3D model class002</a><br><a href="http://7u2kdd.com1.z0.glb.clouddn.com/S-class3d-it025-class003-model.png" target="_blank" rel="noopener">3D model class003</a><br><a href="http://7u2kdd.com1.z0.glb.clouddn.com/S-class3d-it025-class004-model.png" target="_blank" rel="noopener">3D model class004</a><br><img src="http://7u2kdd.com1.z0.glb.clouddn.com/S-class3d-it025-class001-model.png" alt="此处输入图片的描述"><br><img src="http://7u2kdd.com1.z0.glb.clouddn.com/S-class3d-it025-class002-model.png" alt="此处输入图片的描述"><br><img src="http://7u2kdd.com1.z0.glb.clouddn.com/S-class3d-it025-class003-model.png" alt="此处输入图片的描述"><br><img src="http://7u2kdd.com1.z0.glb.clouddn.com/S-class3d-it025-class004-model.png" alt="此处输入图片的描述"></p>
<p>此时类似于2D聚类一样需要从中挑选较好的类来继续做3D 重构。<a href="http://7u2kdd.com1.z0.glb.clouddn.com/S-class3d-4class-choose13.png" target="_blank" rel="noopener">class average图片</a>如下,挑选第一类和第三类,将其包含的particles(8194 -&gt; 6495 particles) 存储到<strong>particles_autopick_sort_class2d_class3d.star</strong>：<br><img src="http://7u2kdd.com1.z0.glb.clouddn.com/S-class3d-4class-choose13.png" alt="此处输入图片的描述"><br>下面将<a href="http://7u2kdd.com1.z0.glb.clouddn.com/S-class3d-it025-class1&amp;2&amp;3&amp;4.png" target="_blank" rel="noopener">class1,2,3,4</a> 的3d model 结合在一起 以及将<a href="http://7u2kdd.com1.z0.glb.clouddn.com/S-class3d-it025-class1&amp;3.png" target="_blank" rel="noopener">class 1,3</a>结合在一起显示如下：<br><img src="http://7u2kdd.com1.z0.glb.clouddn.com/S-class3d-it025-class1&amp;2&amp;3&amp;4.png" alt="此处输入图片的描述"><br><img src="http://7u2kdd.com1.z0.glb.clouddn.com/S-class3d-it025-class1&amp;3.png" alt="此处输入图片的描述"></p>
<h2 id="第四步：High-resolution-3D-refinement"><a href="#第四步：High-resolution-3D-refinement" class="headerlink" title="第四步：High-resolution 3D refinement"></a>第四步：High-resolution 3D refinement</h2><h3 id="4-1-目的"><a href="#4-1-目的" class="headerlink" title="4.1 目的"></a>4.1 目的</h3><h3 id="4-2-运行结果"><a href="#4-2-运行结果" class="headerlink" title="4.2 运行结果"></a>4.2 运行结果</h3><p>当按照以上步骤挑选出来了 a subset of suffient homogeneity 后，就可以进行 3D auto-refine procedure.采用 gold-standard Fourier Shell Correlation(FSC)来计算最后的重构结果，同时防止过拟合。</p>
<blockquote>
<p>input: particles_autopick_sort_class2d_class3d.star(6495 particles)<br>reference: <a href="http://7u2kdd.com1.z0.glb.clouddn.com/S-class3d-it025-class003-model.png" target="_blank" rel="noopener">class003</a> or <a href="http://7u2kdd.com1.z0.glb.clouddn.com/S-Initial-model-3I3E-50A.png" target="_blank" rel="noopener">3i3e_lp50A</a></p>
</blockquote>
<p>MPI并行的策略是 1个进程作为master，其他进程分成两部分，分别来处理两部分Random分开的数据集，使用FSC策略。所以最好MPI进程数目为奇数。<br>数据初始迭代的时候会分为两部分单独的进行3D重构，到最后一次迭代时连个模型会joined together，然后明显的提高精度。下面将dispaly最后一次迭代之前的两部分产生的模型,将依次展示：<a href="http://7u2kdd.com1.z0.glb.clouddn.com/S-refine3d-it21-half1-model.png" target="_blank" rel="noopener">half1的模型</a>，<a href="http://7u2kdd.com1.z0.glb.clouddn.com/S-refine3d-it21-half2-model.png" target="_blank" rel="noopener">half2的模型</a>，<a href="http://7u2kdd.com1.z0.glb.clouddn.com/S-refine3d-it21-half1&amp;2.png" target="_blank" rel="noopener">half1&amp;half2的模型</a><br><img src="http://7u2kdd.com1.z0.glb.clouddn.com/S-refine3d-it21-half1-model.png" alt="此处输入图片的描述"><br><img src="http://7u2kdd.com1.z0.glb.clouddn.com/S-refine3d-it21-half2-model.png" alt="此处输入图片的描述"><br><img src="http://7u2kdd.com1.z0.glb.clouddn.com/S-refine3d-it21-half1&amp;2.png" alt="此处输入图片的描述"></p>
<p>最后一次迭代后生成的模型<a href="http://7u2kdd.com1.z0.glb.clouddn.com/S-refine3d-class001-model.png" target="_blank" rel="noopener">class001-model</a>以及其slices图<a href="http://7u2kdd.com1.z0.glb.clouddn.com/S-refine3d-class001-mrc.png" target="_blank" rel="noopener">class001-slices</a>如下：<br><img src="http://7u2kdd.com1.z0.glb.clouddn.com/S-refine3d-class001-model.png" alt="此处输入图片的描述"><br><img src="http://7u2kdd.com1.z0.glb.clouddn.com/S-refine3d-class001-mrc.png" alt="此处输入图片的描述"></p>
<h2 id="第五步：-Postprocessing"><a href="#第五步：-Postprocessing" class="headerlink" title="第五步： Postprocessing"></a>第五步： Postprocessing</h2><h2 id="第六步：-Local-resolution-estimation"><a href="#第六步：-Local-resolution-estimation" class="headerlink" title="第六步： Local-resolution estimation"></a>第六步： Local-resolution estimation</h2><p>[^autopick]: Sjors H.W. Scheres, Semi-automated selection of cryo-EM particles in RELION-1.3, Journal of Structural Biology, Volume 189, Issue 2, February 2015, Pages 114-122, ISSN 1047-8477</p>
<p>[^ximdisp]: J M Smith. Ximdisp–a visualization tool to aid structure determination<br>from electron microscope images. Journal of structural biology, 125(2-<br>3):223–228, May 1999.</p>
<p>[^xmipp]: Sjors H W Scheres, R. Nunez-Ramirez, C. O. S Sorzano, J. M Carazo,<br>and R. Marabini. Image processing for electron microscopy single-particle<br>analysis using XMIPP. Nature Protocols, 3(6):977–90, 2008.</p>
<p>[^e2boxer]: Guang Tang, Liwei Peng, Philip R Baldwin, Deepinder S Mann, Wen Jiang,<br>Ian Rees, and Steven J Ludtke. EMAN2: an extensible image processing<br>suite for electron microscopy. Journal of Structural Biology, 157(1):38–46,<br>January 2007.</p>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">


</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://nejyeah.github.io/2018/02/11/Relion-1.3-User-Guide/" data-title="Relion-1.3 软件使用流程 | Fendrew" data-tsina="" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 

<div class="next">
<a href="/2018/02/11/hello-world/"  title="Hello World">
 <strong>下一篇：</strong><br/> 
 <span>Hello World
</span>
</a>
</div>

</nav>

	
<section id="comments" class="comment">
	<div class="ds-thread" data-thread-key="2018/02/11/Relion-1.3-User-Guide/" data-title="Relion-1.3 软件使用流程" data-url="http://nejyeah.github.io/2018/02/11/Relion-1.3-User-Guide/"></div>
</section>


<section id="comments" class="comment">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
 
 <ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-2-转换为STAR文件"><span class="toc-number">1.</span> <span class="toc-text">1.2.2 转换为STAR文件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-CTF-参数估计"><span class="toc-number"></span> <span class="toc-text">1.3 CTF 参数估计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-颗粒挑选"><span class="toc-number"></span> <span class="toc-text">1.4 颗粒挑选</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-1-人工挑选"><span class="toc-number">1.</span> <span class="toc-text">1.3.1 人工挑选</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-2-半自动挑选-autopick"><span class="toc-number">2.</span> <span class="toc-text">1.3.2 半自动挑选[^autopick]</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5-颗粒排序-可选过程"><span class="toc-number"></span> <span class="toc-text">1.5 颗粒排序(可选过程)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第二步：-Reference-free-2D-class-averaging"><span class="toc-number"></span> <span class="toc-text">第二步： Reference-free 2D class averaging</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-2D-class-averaging-的作用"><span class="toc-number"></span> <span class="toc-text">2.1 2D class averaging 的作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-运行时“exceeds-stack-size”错误及解决办法"><span class="toc-number"></span> <span class="toc-text">2.2 运行时“exceeds stack size”错误及解决办法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-运行2D-classification"><span class="toc-number"></span> <span class="toc-text">2.3 运行2D classification</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第三步：-Unsupervised-3D-classification"><span class="toc-number"></span> <span class="toc-text">第三步： Unsupervised 3D classification</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-目的"><span class="toc-number"></span> <span class="toc-text">3.1 目的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-运行结果"><span class="toc-number"></span> <span class="toc-text">3.2 运行结果</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第四步：High-resolution-3D-refinement"><span class="toc-number"></span> <span class="toc-text">第四步：High-resolution 3D refinement</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-目的"><span class="toc-number"></span> <span class="toc-text">4.1 目的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-运行结果"><span class="toc-number"></span> <span class="toc-text">4.2 运行结果</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第五步：-Postprocessing"><span class="toc-number"></span> <span class="toc-text">第五步： Postprocessing</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第六步：-Local-resolution-estimation"><span class="toc-number"></span> <span class="toc-text">第六步： Local-resolution estimation</span></a>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  
<div class="github-card">
<p class="asidetitle">Github 名片</p>
<div class="github-card" data-github="nejyeah" data-width="220" data-height="119" data-theme="medium">
<script type="text/javascript" src="//cdn.jsdelivr.net/github-cards/latest/widget.js" ></script>
</div>
  </div>



  

  

  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> A master student in HUST. <br/>
			Looking for a Ph.D. program offer in CS.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		
		<a href="https://github.com/nejyeah" target="_blank" class="icon-github" title="github"></a>
		
		
		
		
		
		
		
		
		
		<a href="mailto:feng_wang@hust.edu.cn" target="_blank" class="icon-email" title="Email Me"></a>
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2018 
		
		<a href="/about" target="_blank" title="Feng Wang">Feng Wang</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>



<script type="text/javascript">
  var duoshuoQuery = {short_name:"nejyeah"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 


<script type="text/javascript">

var disqus_shortname = 'fengwang';

(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>






<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->

<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', '', '');  
ga('send', 'pageview');
</script>



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?c84dd43b0573fc9dc08dc6020e25f85e";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
